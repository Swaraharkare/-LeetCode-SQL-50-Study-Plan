/* Write your T-SQL query statement below */

SELECT DISTINCT P.product_id,
ISNULL(P1.price,10) AS price
FROM Products P
LEFT JOIN
(
SELECT DISTINCT product_id,
FIRST_VALUE(new_price) OVER(PARTITION BY product_id ORDER BY change_date DESC ) as price
FROM Products
WHERE change_date < '2019-08-17  '
) P1
ON P.product_id=P1.product_id;
